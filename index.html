<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>

    <style>
      body {
        background: #ccc;
        margin: 0;
      }

    </style>
  </head>

  <body>
    <canvas
      id="canvas"
      onmousemove="onMouseMove(event)"
      onclick="startGame()"
    ></canvas>

    <script>
      const screenWidth = window.innerWidth;
      const screenHeight = window.innerHeight;

      const canvas = document.querySelector("#canvas");
      canvas.width = screenWidth;
      canvas.height = screenHeight;
      const context = canvas.getContext("2d");

      let intervalId;
      let score = 0;

      let player = {
        x: screenWidth / 2,
        y: screenHeight / 2,
        radius: 100,
        color: "red",
      };

      let enemies = [];

      function insertEnemy(){
        const newEnemy = {
          x: 0,
          y: 0,
          radius: 20,
          color: "blue",
          speedX: Math.floor(Math.random()*10 + 5),
          speedY: Math.floor(Math.random()*10 + 5),
        }

        enemies.push(newEnemy);
      }

      function onMouseMove(event) {
        player.x = event.clientX;
        player.y = event.clientY;
      }


      function drawCircle(x, y, radius, color) {
        context.beginPath();
        context.fillStyle = color;
        context.arc(x, y, radius, 0, 2 * Math.PI);
        context.fill();
      }

      function clearScreen() {
        context.clearRect(0, 0, canvas.width, canvas.height);
      }

      function drawPlayer() {
        drawCircle(player.x, player.y, player.radius, player.color);
      }

      function drawEnemy() {
        enemies.forEach(enemy => {
          drawCircle(enemy.x, enemy.y, enemy.radius, enemy.color);
        });
      }

      function moveEnemy() {
        enemies.forEach(enemy => {
          enemy.x += enemy.speedX;
          enemy.y += enemy.speedY;
        });
      }

      function checkEnemyCollision() {

        let collision = false;

        enemies.forEach(enemy => {
          const distance = Math.sqrt((player.x - enemy.x) ** 2 + (player.y - enemy.y) ** 2);

          if (distance < player.radius + enemy.radius){   
            collision = true;
          } 
        });

        return collision;
      }

      function bounceEnemyOnEdge() {

        enemies.forEach(enemy => {
          if (enemy.x < 0 || enemy.x > screenWidth) {
          enemy.speedX *= -1.001;
          }

          if (enemy.y < 0 || enemy.y > screenHeight) {
            enemy.speedY *= -1.001;
          }
        });
      }

      function endGame() {
        alert(`Fim do jogo! Seu score foi de ${score}`);
        clearInterval(intervalId);
        clearInterval(scoreId);
      }

      function startGame() {
        player.x = screenWidth / 2;
        player.y = screenHeight / 2;

        insertEnemy();

        intervalId = setInterval(gameLoop, 1000 / 60);
        scoreId = setInterval(() => score++, 1000);
      }

      function gameLoop() {
        clearScreen();
        moveEnemy();

        if (checkEnemyCollision()) {
          endGame();
        }

        bounceEnemyOnEdge();

        drawPlayer();
        drawEnemy();

        const insertNewEnemyProbability = Math.random();
        if (insertNewEnemyProbability > 0.998){
          insertEnemy();
        }


      }

      startGame();
    </script>
  </body>
</html>